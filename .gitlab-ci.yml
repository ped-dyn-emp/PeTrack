stages:
  - build
  - test

cache:
  paths:
    - ./petrack.exe
  key: ${CI_COMMIT_REF_SLUG}  # Cache for each branch


build_windows:
  stage: build
  tags:
    - windows
  script:
    - C:\Qt\5.14.1\mingw73_64\bin\qmake.exe C:\Users\Deniz\Documents\petrack\petrack.pro -spec win32-g++ "CONFIG+=debug" "CONFIG+=qml_debug"
    - mingw32-make.exe -j6

# Ggf. muss man nicht in den Ordner der Testskripte verzweigen, da PyTest auch rekusrsiv in Unterorndern nach tests sucht
regression test windows:
  stage: test
  tags:
    - windows
  script:
    - cd tests/regression_test/tests
    - python -m pytest --junitxml=pytest_report.xml | Tee-Object -FilePath "RegressionTestLog.txt"
  artifacts:
    when: on_failure
    paths:
      - "tests/regression_test/tests/RegressionTestLog.txt"
    reports:
      junit: "tests/regression_test/tests/pytest_report.xml"
  needs: ["build_windows"]
